# Multiple Regression

## Introduction

A **multiple regression** is a way to model the linear relationship between one quantitative response variable and more than one predictor variable. Ex: A multiple regression model can be used to model the linear relationship between the quality of a car component and manufacturing inputs, such as machine speed and cutting angle. Y=Quality is the response variable, while X1=Speed and X2=Angle are predictor variables represented in the figure below. The **response variable** is the variable being modeled or predicted, while the **predictor variables** are the variables used to predict the response.

**Note:** A multiple regression model has two parts.

* The first part is the **linear regression function**, which represents the expected value of Y given a particular set of variables. represented as: E(Y) = β0 + β1X1 + β2X2 + ... + βkXk
  * Where:
    * Y = Response variable
    * X1, X2, ..., Xk = Predictor variables
    * β0 = Intercept
    * β1, β2, ..., βk = Coefficients
    * E(Y) = Expected value of Y
* The second part is the **regression error** term, which represents the difference between the actual value of Y and the expected value of Y. The regression error term is represented as ε = Y - E(Y).
  * Where:
    * ε = Error term
    * Y = Actual value of the response variable
    * E(Y) = Expected value of the response variable

### Example

* Question:
  * The body fat dataset gives the amount of body fat (%), the triceps skinfold circumference (mm), the midarm circumference (cm), and the thigh circumference (cm) of 20 healthy women aged
  25-34 years. A researcher wishes to use multiple regression to understand how body fat depends on these body measurements.
    1. What is the response variable?
    2. What are the predictor variables?
    3. What is the expected value of the response variable?
    4. What is the multiple regression model?

* Solution:
  * The response variable is the amount of body fat (%).
  * The predictor variables are the triceps skinfold circumference (mm), the midarm circumference (cm), and the thigh circumference (cm).
  * The expected value of the response variable can be found with the linear regression function: E(Y) = β0 + β1X1 + β2X2 + β3X3
  * The multiple regression model is represented as: Y = β0 + β1X1 + β2X2 + β3X3 + β4X4 + ε.
    * Where:
      * Y = Body fat (%)
      * X1 = Triceps skinfold circumference (mm)
      * X2 = Midarm circumference (cm)
      * X3 = Thigh circumference (cm)
      * ε = Error term

### Python Practice - Multiple Regression Model

The **mplot3d** toolkit of matplotlib allows plotting of 3D objects such as scatterplots and 2D projections.

```python
from mpl_toolkits.mplot3d import Axes3D
import matplotlib.pyplot as plt
import pandas as pd

df = pd.read_csv("http://data-analytics.zybooks.com/Cars.csv")

fig = plt.figure()

#mplot3d is needed for projection='3d'
ax = fig.add_subplot(111, projection='3d')

ax.scatter(df['Speed'], df['Quality'], df['Angle'], c='b', marker='o')

ax.set_xlabel('Speed, X1')
ax.set_ylabel('Angle, X2')
ax.set_zlabel('Quality, Y')

plt.show()
```

## Estimating the Multiple Regression Model

Once a population linear regression model is proposed, the next step is to estimate the model using sample data to find a sample multiple regression function. The most common method to estimate the model is called "least squares." Intuitively, the least squares method finds the values of the regression parameters, B0,B1...Bn that minimize the sum of squared regression errors.

The sample multiple regression function is represented as: Ŷ = B0 + B1X1 + B2X2 + ... + BnXn where Ŷ is the fitted response value and B0, B1, B2, ..., Bn are the estimates for B0, B1, B2, ..., Bn that minimize the sum of squared errors. The "hat" notation in Ŷ is a statistical convention that denotes a sample estimate.

## Fitted Values and Residuals

A **multiple regression fitted value** is the predicted value of the response variable based on the multiple regression model. The fitted value is represented as Ŷ = B0 + B1X1 + B2X2 + ... + BnXn.

A **multiple regression residual** is the difference between the actual value of the response variable and the fitted value. The residual is represented as ε = Y - Ŷ.

* **Python Practice**

  * The model object generated by statsmodels also contains the fitted values and residuals for each sample. To display the fitted values, the fittedvalues property of the model is called.

  ```python
  import pandas as pd
  import statsmodels.formula.api as sms

  fat = pd.read_csv('https://static-resources.zybooks.com/static/fat.csv')

  # Response variable
  Y = fat['body_fat_percent']

  # Generates the linear regression model
  # Multiple predictor variables are joined with +
  model = sms.ols('Y ~ triceps_skinfold_thickness_mm + midarm_circumference_cm + thigh_circumference_cm', data = fat).fit()

  # Prints a list of the fitted values for each sample
  print(model.fittedvalues)

  # Prints a list of the residuals for each sample
  print(model.resid)
  ```

  Multiple regression was performed on the cars dataset with quality as the response variable and speed and angle as the predictor variables. The following fitted values and residuals were obtained.

  ```python
  import pandas as pd
  import statsmodels.formula.api as sms

  cars = pd.read_csv('http://data-analytics.zybooks.com/Cars.csv')

  # Response variable
  Y = cars['Quality']

  # Generates the linear regression model
  # Multiple predictor variables are joined with +
  model = sms.ols('Y ~ Speed + Angle', cars).fit()

  # Prints a list of the fitted values for each sample
  print(model.fittedvalues)

  # Prints a list of the residuals for each sample
  print(model.resid)
  ```
